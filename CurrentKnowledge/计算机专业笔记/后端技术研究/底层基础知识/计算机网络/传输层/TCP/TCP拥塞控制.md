# TCP拥塞控制
TCP拥塞控制是避免网络雪崩式拥塞所采取拥塞控制措施。

> 计算机网络是共享的，流量控制避免的是发送方淹没接收方的接收空间，而拥塞控制是避免发送方填满整个网络。
> 当网络极度拥堵时，如果没有拥塞控制，发送方持续发送大量的报文，而这些报文因为网络阻塞而延时、丢失，触发了TCP重传，重传使得网络更加阻塞，整个网络将会陷入不可用的状态。  

## 拥塞窗口
拥塞窗口是发送方维护的一个窗口，会根据网路拥堵情况动态调节。  
之前发送端口等于接收窗口，加入拥塞窗口的概念后，发送窗口 = Min(拥塞窗口, 接收窗口)。

拥塞窗口的变化规则 
- 只要网络中没有出现阻塞，窗口就会增大 
- 网络中出现阻塞，窗口就会减小

## 拥塞控制算法
### 慢启动
慢启动（Slow-start）是用于结合其他阶段算法，来避免发送过多数据到网络中而导致网络拥塞。
1. 慢启动初始启动时设置拥塞窗口值为1、2、4或10个MSS
2. 拥塞窗口在每接收到一个确认包时增加，每个RTT内成倍增加
3. 发送速率随着慢启动的进行而快速增加，直到遇到出现丢失、达到慢启动阈值、或者接收方的接收窗口进行限制。 
4. 当达到慢启动阈值（ssThresh）时，慢启动算法就会转换为线性增长的阶段 (**也称拥塞避免**)。
5. 如果发生丢失，则TCP推断网络出现了拥塞，会试图采取措施来降低网络负载。

> 对于处理报文丢失这个事件上，不同拥塞控制算法表现有所不同
### 快速重传（TCP Tahoe）
TCP Tahoe算法中，当发生丢失时，会进入**快速重传**机制.
1. 慢启动阈值设为之前拥塞窗口值的一半.
2. 拥塞窗口值降为初始值，重新进入慢启动阶段。
3. 当拥塞窗口值达到慢启动阈值时，拥塞窗口按线性速度增加

### 快速恢复（TCP Reno）
TCP Reno算法实现了**快速恢复**的机制
1. 重传丢失的报文后，启动一个超时定时器 
2. 慢启动阈值设为之前拥塞窗口值的一半 
3. 同时该阈值作为新的拥塞窗口值，跳过慢启动阶段，直接进入拥塞控制阶段 
4. 如果仍然超时，则回到慢启动阶段


### TCP Vegas
TCP Vegas通过度量传输缓存中每个传送报文来代替只度量一个报文，根据每次度量的平均值来增加拥塞窗口

> 之前的TCP度量延迟和RTT都是以传输缓存中最后一个被传送的报文为准。

一些研究认为该算法和其他拥塞算法混合使用，可能会导致性能竞争不及其他算法

### TCP New Reno
TCP New Reno 是对TCP Reno中快速恢复阶段的重传进行改善的一种改进算法。  
TCP New Reno 用一种较为严谨的方式进入拥塞避免阶段，而不是像Reno一样一旦重传成功后就进入拥塞避免阶段（拥塞窗口多次进入拥塞控制阶段而多次下降）。


